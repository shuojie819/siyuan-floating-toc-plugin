# Floating TOC for SiYuan (思源笔记悬浮大纲插件)

一个功能强大的思源笔记悬浮大纲插件，灵感来源于 Obsidian 的交互体验。提供智能的悬浮、折叠、自动定位功能，让长文档阅读和导航变得丝般顺滑。

## 🔥 核心突破

*   **🌐 全场景覆盖**
    *   **多窗口/分屏支持**：完美支持思源的分屏功能，自动识别当前激活的编辑器，每个文档窗口拥有独立的悬浮大纲。
    *   **全局搜索预览**：在全局搜索结果的预览界面中也能显示悬浮大纲，方便快速定位。
    *   **历史版本预览**：查看文档历史版本时，同样支持大纲导航，助你快速比对历史内容。

*   **👁️ 深度聚焦跟随**
    *   **智能跟随**：完美支持思源的“聚焦 (Zoom In)”模式。默认情况下，大纲自动切换为只显示当前聚焦范围内的内容。
    *   **全文高亮**：可在设置中关闭“跟随聚焦模式”，此时显示全文大纲，但会通过醒目的边框高亮当前聚焦的区域，助你掌控全局。
    *   **智能导航**：在聚焦模式下点击大纲中不可见的标题（位于聚焦范围外），插件会自动退出聚焦模式并精准跳转到目标位置。

*   **🗂️ 数据库大纲支持**
    *   **数据库分组增强**：当聚焦到包含分组的数据库（Attribute View）时，大纲会自动切换模式以正确显示分组信息，确保导航体验一致。

## ✨ 强大特性

*   **📌 双模式交互**
    *   **展开模式 (Expanded)**：完整显示文档大纲树，支持多级折叠。
    *   **迷你模式 (Collapsed)**：收起为极简的“迷你条”，仅显示与标题层级对应的指示条。鼠标悬停即可快速预览大纲，点击即可跳转。

*   **🎯 智能停靠与避让**
    *   **智能跟随**：自动吸附在文档内容两侧，宽屏时紧贴正文，窄屏时自动调整位置。
    *   **防遮挡设计**：
        *   **固定模式 (Pin)**：自动推开文档内容，确保互不遮挡。
        *   **左侧智能避让**：当停靠在左侧时，会自动为文档添加安全边距，确保块标（Gutter 区域）不被遮挡，始终保持可交互状态。
    *   **自由停靠**：支持一键切换左侧/右侧停靠。

*   **⚡ 极致性能与同步**
    *   **秒级响应**：基于 WebSocket 深度集成，文档增删改（包括标题的移动、删除）大纲实时更新，零延迟。
    *   **平滑滚动**：点击标题平滑滚动到对应位置，并高亮显示。
    *   **滚动同步**：阅读文档时，大纲自动高亮当前所在的标题章节。
    *   **自然动画**：精心调优的展开/收起动画，右侧停靠时从右向左弹出，符合直觉。

## 🎨 个性化定制

*   **自定义 CSS**：支持输入自定义 CSS 代码，自由调整大纲的字体、颜色、背景等样式。
*   **自适应高度**：可开启“自适应高度”模式，使大纲容器高度根据内容自动调整，不再强制占满页面，界面更紧凑。
*   **Mini 大纲宽度**：可自定义折叠状态下的大纲条宽度（20px - 50px）。
*   **工具栏定制**：可在设置中自定义悬浮工具栏的按钮显示（如开启/关闭“置顶”、“刷新”等功能）。
*   **全新设置面板**：采用现代化双栏布局（Svelte 构建），支持中英双语，提供原生且流畅的配置体验。

## 🛠️ 实用工具栏

*   **一键置顶/置底**：快速跳转到文档开头或结尾。采用“智能原生模拟机制”，优先检查文档加载状态，仅在需要时模拟 Ctrl+Home/End，完美支持大文档的动态加载且更高效。
*   **全部折叠/展开**：一键整理大纲视图，支持智能识别文档最小标题层级。
*   **宽度拖拽**：支持自定义大纲宽度。
*   **刷新文档**：一键刷新当前文档。采用“思源原生刷新 API + 模拟点击 + F5 键盘事件”的三重保障机制，确保刷新操作更稳定、快速。

## 🎮 使用说明

*   **切换显示**：点击顶栏的列表图标可开启/关闭当前文档的大纲。
*   **固定模式**：点击大纲顶部的图钉图标 📌，开启固定模式（会挤压文档内容区域）。
*   **切换方向**：点击大纲顶部的交换图标 ↔️，切换左右停靠位置。
*   **调整宽度**：鼠标移动到大纲边缘，拖拽即可调整宽度。

## 🤝 致谢 (Acknowledgement)

特别感谢 [b8l8u8e8](https://github.com/b8l8u8e8) 对本项目的重大贡献：

*   ✅ 增加全局搜索、历史文件中使用悬浮大纲的功能
*   ✅ 修复开关只作用于思源文档而不作用于全局搜索、历史文件的问题
*   ✅ 优化图标设计
*   ✅ 修正 plugins.json 中的 URL
*   ✅ 解决“只有在搜索激活的第一个界面可以显示正确的标题大纲”的问题

## 📝 开发

```bash
# 安装依赖
npm install

# 开发模式 (监听文件变化)
npm run dev

# 构建插件
npm run build
```

## 📄 License

MIT
